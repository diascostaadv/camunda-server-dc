# Camunda Platform - Production Environment
ENVIRONMENT=production

# Network Configuration
NETWORK_DRIVER=bridge

# Database Mode Configuration
EXTERNAL_DATABASE_MODE=true

# PostgreSQL Configuration - Azure Database for PostgreSQL
POSTGRES_DB=postgres
POSTGRES_USER=root_camunda
POSTGRES_PASSWORD=@CamundaDC@2025
POSTGRES_PORT=5432

# Database Connection (URI-based) - Azure Database for PostgreSQL
# Example: jdbc:postgresql://camunda-db.postgres.database.azure.com:5432/camunda?sslmode=require&user=adminuser&password=yourpassword
DATABASE_URL=jdbc:postgresql://camunda-dc-db.postgres.database.azure.com:5432/postgres?sslmode=require

# Camunda Configuration
CAMUNDA_PORT=8080
CAMUNDA_JMX_PORT=9404
TZ=America/Sao_Paulo

# Monitoring Configuration
PROMETHEUS_PORT=9090
GRAFANA_PORT=3001
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=admin_prod_2024

# Scaling Configuration
CAMUNDA_REPLICAS=1

# JVM Memory Configuration (Optimized for large cascade delete operations)
# VM Specs: 4 CPU, 8GB RAM
# Allocating ~6GB for JVM (leaving 2GB for OS and buffers)
# -Xms4g: Initial heap size (4GB) - increased for better performance
# -Xmx6g: Maximum heap size (6GB) - using more available memory
# -XX:+UseG1GC: Use G1 Garbage Collector (low latency, good for multi-core)
# -XX:MaxGCPauseMillis=500: Increased pause time tolerance for batch operations
# -XX:ParallelGCThreads=4: Match CPU count for parallel GC
# -XX:ConcGCThreads=2: Concurrent GC threads (typically CPU/2)
# -XX:+HeapDumpOnOutOfMemoryError: Generate heap dump on OOM for analysis
# -XX:HeapDumpPath=/tmp: Store heap dumps in /tmp
# -XX:+UseStringDeduplication: Reduce memory for duplicate strings (common in BPM)
# -XX:G1ReservePercent=20: Reserve 20% for G1 to prevent sudden allocation failures
JAVA_OPTS_EXTRA=-Xms4g -Xmx6g -XX:+UseG1GC -XX:MaxGCPauseMillis=500 -XX:ParallelGCThreads=4 -XX:ConcGCThreads=2 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp -XX:+UseStringDeduplication -XX:G1ReservePercent=20

# Database Connection Pool Optimization (HikariCP - Azure PostgreSQL compatible)
# Connection timeout: Time to wait for connection from pool
DB_CONNECTION_TIMEOUT=60000
# Idle timeout: Max time a connection can sit idle before being removed (5 min - Azure closes after 10min)
DB_IDLE_TIMEOUT=300000
# Max lifetime: Max time a connection can live before being recycled (20 min - prevent Azure timeout)
DB_MAX_LIFETIME=1200000
# Maximum pool size: Max total connections (Azure Flexible has limit based on tier)
DB_MAXIMUM_POOL_SIZE=15
# Minimum idle connections: Keep connections alive
DB_MINIMUM_IDLE=5
# Validation timeout: Time to test connection health
DB_VALIDATION_TIMEOUT=5000
# Keepalive time: Send keepalive to prevent Azure from closing idle connections (4 min)
DB_KEEPALIVE_TIME=240000
# Leak detection threshold: Detect connection leaks (0 = disabled, use for debugging)
DB_LEAK_DETECTION_THRESHOLD=0

CAMUNDA_ADMIN_PASSWORD=admin_prod_2024@
RABBITMQ_URL=amqp://gateway_admin:gateway_prod_password_2024@201.23.69.65:5672/worker_gateway
