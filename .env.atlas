# ============================================================================
# CAMUNDA BPM ECOSYSTEM - ENVIRONMENT CONFIGURATION TEMPLATE
# ============================================================================
# This is a template file for environment configuration
# Copy this file to .env.local, .env.atlas, or .env.production and customize
# ============================================================================

# ============================================================================
# GENERAL CONFIGURATION
# ============================================================================

# Environment type: local, atlas, production, development, staging
ENVIRONMENT=local

# Application name and version
APP_NAME="Camunda BPM Ecosystem"
APP_VERSION="1.0.0"

# Debug mode (automatically set to true for local/development)
DEBUG=false

# Logging configuration
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FILE_PATH=/var/log  # Optional: path for log files

# Security (REQUIRED for production)
SECRET_KEY=  # Generate a secure random key for production
API_KEY_HEADER=X-API-Key

# ============================================================================
# NETWORK CONFIGURATION
# ============================================================================

# Docker network driver: bridge (local), overlay (swarm), host, none
NETWORK_DRIVER=bridge

# Use external Docker network
EXTERNAL_NETWORK=false

# External services mode (true = use cloud services, false = use local containers)
EXTERNAL_SERVICES_MODE=false

# ============================================================================
# MONGODB CONFIGURATION
# ============================================================================

# MongoDB connection (for Atlas or custom connection)
MONGODB_URI=  # mongodb+srv://user:pass@cluster.mongodb.net/database

# Local MongoDB configuration (used when EXTERNAL_SERVICES_MODE=false)
MONGO_HOST=localhost
MONGO_PORT=27017
MONGO_USERNAME=admin
MONGO_PASSWORD=admin123
MONGODB_AUTH_SOURCE=admin

# Database and collections
MONGODB_DATABASE=worker_gateway
COLLECTION_TASKS=tasks
COLLECTION_LOTES=lotes
COLLECTION_PUBLICACOES_BRONZE=publicacoes_bronze
COLLECTION_PUBLICACOES_PRATA=publicacoes_prata
COLLECTION_HASHES=hashes

# MongoDB connection pool
MONGODB_MAX_POOL_SIZE=50
MONGODB_MIN_POOL_SIZE=5
MONGODB_MAX_IDLE_TIME_MS=30000
MONGODB_SERVER_SELECTION_TIMEOUT_MS=5000
MONGODB_SOCKET_TIMEOUT_MS=20000

# MongoDB SSL/TLS
MONGODB_SSL=false  # Automatically true for Atlas
MONGODB_SSL_CERT_REQS=  # none, optional, required

# MongoDB retry and consistency
MONGODB_RETRY_WRITES=true
MONGODB_RETRY_READS=true
MONGODB_WRITE_CONCERN=majority
MONGODB_READ_CONCERN=majority

# ============================================================================
# RABBITMQ CONFIGURATION
# ============================================================================

# RabbitMQ connection URL (for cloud or custom connection)
RABBITMQ_URL=  # amqp://user:pass@host:5672/vhost

# Local RabbitMQ configuration (used when EXTERNAL_SERVICES_MODE=false)
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_MGMT_PORT=15672
RABBITMQ_USER=admin
RABBITMQ_PASSWORD=admin123
RABBITMQ_VHOST=worker_gateway

# Exchange and queue configuration
RABBITMQ_EXCHANGE=worker_gateway
RABBITMQ_EXCHANGE_TYPE=topic  # direct, topic, fanout, headers
RABBITMQ_EXCHANGE_DURABLE=true
RABBITMQ_QUEUE_PREFIX=task
RABBITMQ_QUEUE_DURABLE=true
RABBITMQ_QUEUE_AUTO_DELETE=false

# Connection pool
RABBITMQ_CONNECTION_ATTEMPTS=3
RABBITMQ_RETRY_DELAY=2
RABBITMQ_HEARTBEAT=600
RABBITMQ_BLOCKED_CONNECTION_TIMEOUT=300
RABBITMQ_SOCKET_TIMEOUT=5

# Consumer configuration
RABBITMQ_PREFETCH_COUNT=1
RABBITMQ_AUTO_ACK=false

# Publisher configuration
RABBITMQ_CONFIRM_DELIVERY=true
RABBITMQ_MANDATORY=true
RABBITMQ_PERSISTENT_MESSAGES=true

# SSL/TLS configuration
RABBITMQ_SSL=false
RABBITMQ_SSL_CERT=  # Path to SSL certificate
RABBITMQ_SSL_KEY=  # Path to SSL key
RABBITMQ_SSL_CA=  # Path to CA certificate

# Dead letter configuration
RABBITMQ_ENABLE_DLX=true
RABBITMQ_DLX_NAME=dlx_worker_gateway
RABBITMQ_DLX_TTL=86400000  # 24 hours in milliseconds

# Redis configuration (if using Redis instead of RabbitMQ)
REDIS_URI=redis://localhost:6379
REDIS_PORT=6379

# ============================================================================
# CAMUNDA BPM CONFIGURATION
# ============================================================================

# Camunda engine connection
CAMUNDA_URL=http://localhost:8080/engine-rest
CAMUNDA_USERNAME=demo
CAMUNDA_PASSWORD=demo

# Worker configuration
WORKER_ID=  # Auto-generated if not set
MAX_TASKS=1
LOCK_DURATION=60000  # milliseconds
ASYNC_RESPONSE_TIMEOUT=30000  # milliseconds
POLLING_INTERVAL=30  # seconds

# Retry configuration
RETRIES=3
RETRY_TIMEOUT=5000  # milliseconds
RETRY_BACKOFF_FACTOR=2.0

# Process configuration
DEFAULT_PROCESS_KEY=default_process
PROCESS_VARIABLES_PREFIX=

# HTTP client configuration
HTTP_TIMEOUT=30  # seconds
HTTP_MAX_RETRIES=3
HTTP_VERIFY_SSL=true

# Worker deployment mode
WORKERS_MODE=separated  # separated, embedded, unified

# Deployment configuration
AUTO_DEPLOY_RESOURCES=false
BPMN_RESOURCES_PATH=

# ============================================================================
# WORKER API GATEWAY CONFIGURATION
# ============================================================================

# Gateway server
GATEWAY_HOST=0.0.0.0
GATEWAY_PORT=8000
GATEWAY_REPLICAS=1

# Gateway integration
GATEWAY_ENABLED=false
GATEWAY_URL=http://localhost:8000
GATEWAY_COMMUNICATION_MODE=http  # http, rabbitmq
GATEWAY_HTTP_TIMEOUT=30  # seconds

# API configuration
API_PREFIX=/api
API_VERSION=v1
CORS_ENABLED=true
CORS_ORIGINS=*  # Restrict in production: https://example.com,https://app.example.com

# Task processing
TASK_QUEUE_SIZE=100
TASK_WORKER_THREADS=4
TASK_TIMEOUT=300  # seconds
TASK_RETRY_LIMIT=3
TASK_RETRY_DELAY=60  # seconds

# Health checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health

# Rate limiting
RATE_LIMIT_ENABLED=false
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_PERIOD=60  # seconds

# ============================================================================
# WORKER PLATFORM CONFIGURATION
# ============================================================================

# Worker scaling
WORKER_HELLO_REPLICAS=0
WORKER_PUBLICACAO_REPLICAS=0
WORKER_PUBLICACAO_UNIFIED_REPLICAS=1

# Worker discovery
AUTO_DISCOVER_WORKERS=true
WORKERS_PATH=workers

# Worker performance
WORKER_CONCURRENCY=1
WORKER_PREFETCH_COUNT=1
SLEEP_SECONDS=30

# External APIs
INTIMATION_USER=
INTIMATION_PASSWORD=
INTIMATION_API_URL=http://localhost:3000/api
NOTIFICATION_API_URL=http://localhost:3000/api
NOTIFICATION_API_KEY=

# Data processing
DATA_PROCESSING_TIMEOUT=300  # seconds
MAX_FILE_SIZE=10485760  # 10MB in bytes

# ============================================================================
# MONITORING AND METRICS
# ============================================================================

# Metrics configuration
METRICS_ENABLED=true
METRICS_PORT=9000
ENABLE_METRICS=true  # Camunda-specific metrics
METRICS_INTERVAL=60  # seconds

# ============================================================================
# PRODUCTION REQUIREMENTS
# ============================================================================
# The following settings are REQUIRED for production environment:
#
# 1. Security:
#    - SECRET_KEY must be set to a secure random value
#    - DEBUG must be false
#    - HTTP_VERIFY_SSL must be true
#
# 2. Authentication:
#    - CAMUNDA_USERNAME and CAMUNDA_PASSWORD must be set
#    - API keys for external services must be configured
#
# 3. High Availability:
#    - GATEWAY_REPLICAS should be >= 2
#    - Worker replicas should be configured based on load
#
# 4. External Services:
#    - MONGODB_URI must point to production MongoDB (Atlas recommended)
#    - RABBITMQ_URL must point to production message broker
#    - SSL/TLS should be enabled for all connections
#
# 5. CORS and Rate Limiting:
#    - CORS_ORIGINS must be restricted to specific domains
#    - RATE_LIMIT_ENABLED should be true
#
# 6. Monitoring:
#    - METRICS_ENABLED should be true
#    - LOG_LEVEL should be INFO or WARNING (not DEBUG)
#
# ============================================================================
# ENVIRONMENT-SPECIFIC FILES
# ============================================================================
# Create separate files for each environment:
#
# .env.local       - Local development with Docker containers
# .env.atlas       - MongoDB Atlas with local services
# .env.production  - Full production configuration
# .env.development - Development server configuration
# .env.staging     - Staging environment configuration
#
# ============================================================================ENVIRONMENT=atlas
EXTERNAL_SERVICES_MODE=true
